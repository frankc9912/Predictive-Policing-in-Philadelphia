View(neigh)
crs <- "ESRI:102728"
neigh <-
st_read(paste0(
project_path, "/philadelphia-neighborhoods.geojson"
)) %>%
st_transform(crs = crs)
phl_crs <- "ESRI:102728"
po_district <-
st_read(paste0(
project_path, "/Police_District.geojson"
)) %>%
st_transform(crs = phl_crs)
View(po_district)
View(neigh)
crime <- read.csv(paste0(
project_path, "/crime_incidents.csv"
))
View(crime)
a <- crime %>% distinct(text_general_code)
View(a)
a <- crime %>% filter(str_detect(text_general_code, "Narcotic"))
View(a)
crime2017 <- read.csv("D:/R_process/Frank_ChenHW3/data/crime2017.csv")
domebatt <- crime2017 %>%
filter(Primary.Type == "BATTERY" & str_detect(Description, "DOMESTIC")) %>%
mutate(x = gsub("[()]", "", Location)) %>%
separate(x,into= c("Y","X"), sep=",") %>%
mutate(X = as.numeric(X),Y = as.numeric(Y)) %>%
na.omit() %>%
st_as_sf(coords = c("X", "Y"), crs = 4326, agr = "constant")%>%
st_transform('ESRI:102271') %>%
distinct()
View(domebatt)
group_by(crime2017, Primary.Type) %>%
summarize(count = n()) %>%
arrange(-count) %>%
kable() %>%
kable_styling()
crime2017 %>% filter(Primary.Type == "BATTERY" & str_detect(Description, "DOMESTIC")) %>%
group_by(Location.Description) %>%
summarize(count = n()) %>%
arrange(-count) %>%
kable() %>%
kable_styling()
domebatt <- crime2017 %>%
filter(Primary.Type == "NARCOTICS") %>%
mutate(x = gsub("[()]", "", Location)) %>%
separate(x,into= c("Y","X"), sep=",") %>%
mutate(X = as.numeric(X),Y = as.numeric(Y)) %>%
na.omit() %>%
st_as_sf(coords = c("X", "Y"), crs = 4326, agr = "constant")%>%
st_transform('ESRI:102271') %>%
distinct()
View(domebatt)
View(a)
a <- crime %>% filter(str_detect(ucr_general, "18"))
View(a)
pub_ser <- read.csv(paste0(
project_path, "/public_cases_311.csv"
))
View(pub_ser)
b <- pub_ser %>% distinct(service_name)
View(b)
abd_vehicle <-
pub_ser %>%
filter(service_name == "Abandoned Vehicle")
View(abd_vehicle)
abd_vehicle <-
pub_ser %>%
filter(service_name == "Abandoned Vehicle") %>%
dplyr::select(Y = lat, X = lon) %>%
na.omit()
abd_vehicle <-
pub_ser %>%
filter(service_name == "Abandoned Vehicle") %>%
dplyr::select(Y = lat, X = lon)
abd_vehicle <-
pub_ser %>%
filter(service_name == "Abandoned Vehicle") %>%
dplyr::select(Y = lat, X = lon) %>%
na.omit()
abd_vehicle <-
pub_ser %>%
filter(service_name == "Abandoned Vehicle") %>%
dplyr::select(Y = lat, X = lon) %>%
na.omit() %>%
st_as_sf(coords = c("X", "Y"), crs = 4326, agr = "constant") %>%
st_transform(crs = phl_crs) %>%
mutate(Legend = "Abandoned_Cars")
a <- crime %>% distinct(text_general_code)
View(a)
a <- crime %>% filter(str_detect(text_general_code, "Burglary"))
View(a)
group_by(crime, text_general_code) %>%
summarize(count = n()) %>%
arrange(-count) %>%
kable() %>%
kable_styling()
a <- crime %>% filter(str_detect(ucr_general, c("100", "200", "300", "400", "500")))
felony <- c("100", "200", "300", "400", "500")
a <- crime %>% filter(str_detect(ucr_general, felony))
a <- crime %>% filter(ucr_general %in% c("100", "200", "300", "400", "500"))
group_by(crime, ucr_general) %>%
summarize(count = n()) %>%
arrange(-count) %>%
kable() %>%
kable_styling()
group_by(crime, ucr_general) %>%
summarize(count = n()) %>%
arrange(ucr_general) %>%
kable() %>%
kable_styling()
a <- crime %>% filter(ucr_general %in% c("100", "200", "300", "400", "500")))
a <- crime %>% filter(ucr_general %in% c("100", "200", "300", "400", "500"))
crime_23 <- read.csv(paste0(
project_path, "/crime_incidents_2023.csv"
))
crime_22 <- read.csv(paste0(
project_path, "/crime_incidents_2022.csv"
))
View(crime_22)
View(crime_23)
a <- crime_22 %>% filter(ucr_general %in% c("100", "200", "300", "400", "500"))
felony <-
crime_22 %>%
filter(ucr_general %in% c("100", "200", "300", "400", "500"))
View(felony)
felony <-
crime_22 %>%
filter(ucr_general %in% c("100", "200", "300", "400", "500")) %>%
dplyr::select(Y = lat, X = lng) %>%
na.omit() %>%
st_as_sf(coords = c("X", "Y"), crs = 4326, agr = "constant") %>%
st_transform(crs = phl_crs) %>%
mutate(Legend = "felony")
felony_22 <-
crime_22 %>%
filter(ucr_general %in% c("100", "200", "300", "400", "500")) %>%
dplyr::select(Y = lat, X = lng) %>%
na.omit() %>%
st_as_sf(coords = c("X", "Y"), crs = 4326, agr = "constant") %>%
st_transform(crs = phl_crs) %>%
mutate(Legend = "felony")
felony_23 <-
crime_23 %>%
filter(ucr_general %in% c("100", "200", "300", "400", "500")) %>%
dplyr::select(Y = lat, X = lng) %>%
na.omit() %>%
st_as_sf(coords = c("X", "Y"), crs = 4326, agr = "constant") %>%
st_transform(crs = phl_crs) %>%
mutate(Legend = "felony")
View(felony_22)
dan_building <-
pub_ser %>%
filter(service_name == "Dangerous Building Complaint")
View(dan_building)
dan_building <-
pub_ser %>%
filter(service_name == "Dangerous Building Complaint") %>%
dplyr::select(Y = lat, X = lon) %>%
na.omit() %>%
st_as_sf(coords = c("X", "Y"), crs = 4326, agr = "constant") %>%
st_transform(crs = phl_crs) %>%
mutate(Legend = "Dangerous_Building")
pub_ser <- read.csv(paste0(
project_path, "/public_cases_311.csv"
))
View(pub_ser)
b <- pub_ser %>% distinct(service_name)
View(b)
abd_vehicle <-
pub_ser %>%
filter(service_name == "Abandoned Vehicle") %>%
dplyr::select(Y = lat, X = lon) %>%
na.omit() %>%
st_as_sf(coords = c("X", "Y"), crs = 4326, agr = "constant") %>%
st_transform(crs = phl_crs) %>%
mutate(Legend = "Abandoned_Cars")
dan_building <-
pub_ser %>%
filter(service_name == "Dangerous Building Complaint") %>%
dplyr::select(Y = lat, X = lon) %>%
na.omit() %>%
st_as_sf(coords = c("X", "Y"), crs = 4326, agr = "constant") %>%
st_transform(crs = phl_crs) %>%
mutate(Legend = "Dangerous_Building")
graffiti <-
pub_ser %>%
filter(service_name == "Graffiti Removal") %>%
dplyr::select(Y = lat, X = lon) %>%
na.omit() %>%
st_as_sf(coords = c("X", "Y"), crs = 4326, agr = "constant") %>%
st_transform(crs = phl_crs) %>%
mutate(Legend = "Graffiti")
sanitation <-
pub_ser %>%
filter(str_detect(service_name, "Sanitation")) %>%
dplyr::select(Y = lat, X = lon) %>%
na.omit() %>%
st_as_sf(coords = c("X", "Y"), crs = 4326, agr = "constant") %>%
st_transform(crs = phl_crs) %>%
mutate(Legend = "Sanitation")
View(sanitation)
st_light_out <-
pub_ser %>%
filter(service_name == "Street Light Outage") %>%
dplyr::select(Y = lat, X = lon) %>%
na.omit() %>%
st_as_sf(coords = c("X", "Y"), crs = 4326, agr = "constant") %>%
st_transform(crs = phl_crs) %>%
mutate(Legend = "Street_Light_Outage")
bl <-
read.csv(paste0(
project_path, "/business_licenses.csv"
))
View(bl)
c <- bl %>% distinct(licensetype)
View(c)
beverage <- read.csv(paste0(
project_path, "/beverage_tax_registration_data.csv"
))
View(beverage)
bl <-
read.csv(paste0(
project_path, "/com_act_licenses.csv"
))
View(bl)
c <- bl %>% distinct(licensetype)
View(c)
bl <-
read.csv(paste0(
project_path, "/trade_licenses.csv"
))
View(bl)
c <- bl %>% distinct(licensetype)
View(c)
bl <-
read.csv(paste0(
project_path, "/business_licenses.csv"
))
c <- bl %>% distinct(licensetype)
View(a)
View(b)
tobacco <- st_read(paste0(
project_path, "/Tobacco_Retailer_Permits.geojson"
))
View(tobacco)
po_serv_area <-
st_read(paste0(
project_path, "/Boundaries_PSA.geojson"
)) %>%
st_transform(crs = phl_crs)
View(po_serv_area)
bl <-
read.csv(paste0(
project_path, "/business_licenses.csv"
))
c <- bl %>% distinct(licensetype)
liq_retail <-
bl %>%
filter(str_detect(legalname, "tavern"))
View(liq_retail)
liq_retail <-
bl %>%
filter(str_detect(business_name, "tavern"))
View(liq_retail)
liq_var <- c("tavern", "Tavern", "TAVERN")
liq_retail <-
bl %>%
filter(str_detect(business_name, liq_var))
liq_retail <- data.frame()
for (i in liq_var) {
liq_retail <-
bl %>%
filter(str_detect(business_name, i %in% liq_var)) %>%
rbind(bl)
}
liq_retail <- data.frame()
for (i in liq_var) {
liq_retail <-
bl %>%
filter(str_detect(business_name, i)) %>%
rbind(bl)
}
View(liq_retail)
d <- liq_retail %>% distinct(objectid, .keep_all = T)
View(d)
liq_retail <- data.frame()
for (i in liq_var) {
liq_retail <-
bl %>%
filter(str_detect(business_name, i)) %>%
rbind(liq_retail)
}
View(liq_retail)
d <- liq_retail %>% distinct(objectid, .keep_all = T)
liq_var <- c("tavern", "Tavern", "TAVERN", "PUB", "Pub", "pub")
liq_retail <- data.frame()
for (i in liq_var) {
liq_retail <-
bl %>%
filter(str_detect(business_name, i)) %>%
rbind(liq_retail)
}
d <- liq_retail
for (i in liq_var_wrong) {
d <-
d %>%
filter(! str_detect(business_name, i))
}
liq_var_wrong <- c("public", "PUBLIC", "Public")
d <- liq_retail
for (i in liq_var_wrong) {
d <-
d %>%
filter(! str_detect(business_name, i))
}
liq_var <- c("tavern", "Tavern", "TAVERN", "PUB", "Pub", "pub")
liq_var_wrong <- c("public", "PUBLIC", "Public")
liq_retail <- data.frame()
for (i in liq_var) {
liq_retail <-
bl %>%
filter(str_detect(business_name, i)) %>%
rbind(liq_retail)
}
View(liq_retail)
d <- liq_retail
for (i in liq_var_wrong) {
d <-
d %>%
filter(! str_detect(business_name, i))
}
View(d)
d <- liq_retail
for (i in liq_var_wrong) {
d <-
d %>%
filter(! str_detect(business_name, i))
}
liq_var_wrong <- c("publi", "PUBLI", "Publi")
d <- liq_retail
for (i in liq_var_wrong) {
d <-
d %>%
filter(! str_detect(business_name, i))
}
View(d)
liq_retail <-
st_read(paste0(
project_path, "/alcohol_shop.geojson"
))
View(liq_retail)
vacant <-
st_read(paste0(
project_path, "/Vacant_Indicators_Points.geojson"
))
plot(vacant)
plot(dan_building)
red_light_camera <-
read.csv(paste0(
project_path, "/red_light_camera_locations.csv"
))
View(red_light_camera)
View(b)
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE)
# Chunk 2: load packages
library(tidyverse)
library(tidycensus)
library(tigris)
library(sf)
library(ggplot2)
library(scales)
library(extrafont)
library(viridis)
library(raster)
library(spdep)
library(tmap)
library(FNN)
library(grid)
library(gridExtra)
library(kableExtra)
library(classInt)
loadfonts(device = "win")
project_path <- "D:/research/predictive policing/data"
census_api_key("97557b2638bba3200febf4b8196a3444e9628887", overwrite = TRUE)
palette <- c("#c0513d", "#fdb724", "#1ca89d", "#a5bb49")
phl_crs <- "ESRI:102728"
# Chunk 3: functions
plot.theme <- function(){
theme(text = element_text(family = "Calibri", size = 16),
plot.title = element_text(hjust = 0, face = "bold"),
axis.title.x = element_blank(),
axis.title.y = element_text(size = 14, margin = margin(r = 15, unit = "pt")),
plot.caption = element_text(size = 12, vjust = -1.5),
legend.position = "bottom",
legend.margin = margin(t = 0, unit = "pt"),
legend.text = element_text(size = 12),
legend.title = element_text(size = 12),
panel.grid.major.x = element_blank(),
panel.grid.minor.x = element_blank(),
panel.grid.major.y = element_line(color = "gray85"),
panel.grid.minor.y = element_line(color = "gray95"))
}
nn_function <- function(measureFrom,measureTo,k) {
measureFrom_Matrix <-
as.matrix(measureFrom)
measureTo_Matrix <-
as.matrix(measureTo)
nn <-
get.knnx(measureTo, measureFrom, k)$nn.dist
output <-
as.data.frame(nn) %>%
rownames_to_column(var = "thisPoint") %>%
gather(points, point_distance, V1:ncol(.)) %>%
arrange(as.numeric(thisPoint)) %>%
group_by(thisPoint) %>%
summarize(pointDistance = mean(point_distance)) %>%
arrange(as.numeric(thisPoint)) %>%
dplyr::select(-thisPoint) %>%
pull()
return(output)
}
neigh <-
st_read(paste0(
project_path, "/philadelphia-neighborhoods.geojson"
)) %>%
st_transform(crs = phl_crs)
po_district <-
st_read(paste0(
project_path, "/Police_District.geojson"
)) %>%
st_transform(crs = phl_crs)
po_serv_area <-
st_read(paste0(
project_path, "/Boundaries_PSA.geojson"
)) %>%
st_transform(crs = phl_crs)
crime_22 <-
read.csv(paste0(
project_path, "/crime_incidents_2022.csv"
))
crime_23 <-
read.csv(paste0(
project_path, "/crime_incidents_2023.csv"
))
felony_22 <-
crime_22 %>%
filter(ucr_general %in% c("100", "200", "300", "400", "500")) %>%
dplyr::select(Y = lat, X = lng) %>%
na.omit() %>%
st_as_sf(coords = c("X", "Y"), crs = 4326, agr = "constant") %>%
st_transform(crs = phl_crs) %>%
mutate(Legend = "felony")
felony_23 <-
crime_23 %>%
filter(ucr_general %in% c("100", "200", "300", "400", "500")) %>%
dplyr::select(Y = lat, X = lng) %>%
na.omit() %>%
st_as_sf(coords = c("X", "Y"), crs = 4326, agr = "constant") %>%
st_transform(crs = phl_crs) %>%
mutate(Legend = "felony")
pub_ser <- read.csv(paste0(
project_path, "/public_cases_311.csv"
))
View(pub_ser)
a <- pub_ser %>% distinct(service_name)
View(a)
dan_park <-
pub_serpub_ser %>%
filter(service_name == "Parks and Rec Safety and Maintenance") %>%
dplyr::select(Y = lat, X = lon) %>%
na.omit() %>%
st_as_sf(coords = c("X", "Y"), crs = 4326, agr = "constant") %>%
st_transform(crs = phl_crs) %>%
mutate(Legend = "Unsafe_Parks")
dan_park <-
pub_ser %>%
filter(service_name == "Parks and Rec Safety and Maintenance") %>%
dplyr::select(Y = lat, X = lon) %>%
na.omit() %>%
st_as_sf(coords = c("X", "Y"), crs = 4326, agr = "constant") %>%
st_transform(crs = phl_crs) %>%
mutate(Legend = "Unsafe_Parks")
View(dan_park)
vac_building <-
st_read(paste0(
project_path, "/Vacant_Indicators_Points.geojson"
))
View(vac_building)
dan_building <-
pub_ser %>%
filter(service_name == "Dangerous Building Complaint") %>%
dplyr::select(Y = lat, X = lon) %>%
na.omit() %>%
st_as_sf(coords = c("X", "Y"), crs = 4326, agr = "constant") %>%
st_transform(crs = phl_crs) %>%
mutate(Legend = "Dangerous_Building")
View(dan_building)
traffic_count <-
st_read(paste0(
project_path, "/Traffic_Count_Locations.geojson"
))
View(traffic_count)
traffic_count <-
st_read(paste0(
project_path, "/Traffic_Count_Locations.geojson"
)) %>%
filter(setyear == "2022")
View(traffic_count)
